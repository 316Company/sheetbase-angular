{"version":3,"file":"api.service.js","sourceRoot":"","sources":["../../../src/services/api.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, Inject } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { SheetbaseConfigService } from './sheetbase-config.service';\n\nimport { UserDataService } from './user-data.service';\n\n@Injectable()\nexport class ApiService {\n\n  constructor(\n    private http: HttpClient,\n\n    @Inject(SheetbaseConfigService) private CONFIG,\n    private userDataService: UserDataService\n  ) {\n  }\n\n  /**\n   * GET\n   * @param endpoint\n   * @param params\n   */\n  GET(\n    endpoint: string = null,\n    params: any = {}\n  ): Promise<any> {\n    return new Promise((resolve, reject) => {\n\n      if(!this.CONFIG.backend) {\n        console.error('[Error][Sheetbase] No backend for this project!');\n        reject(null);\n      }\n\n      // build uri\n      let uri: string = 'https://script.google.com/macros/s/'+ this.CONFIG.backend +'/exec';\n      if(endpoint) uri += '?e='+ endpoint;\n      if(!endpoint && Object.keys(params||{}).length > 0) uri += '?';\n      for(let key in (params||{})) {\n        uri += '&'+ key +'='+ params[key];\n      }\n      if(!endpoint && Object.keys(params||{}).length > 0) uri = uri.replace('?&', '?');\n\n      // get data\n      if(!endpoint && Object.keys(params).length < 1) {\n        uri += '?apiKey='+ this.CONFIG.apiKey;\n      } else {\n        uri += '&apiKey='+ this.CONFIG.apiKey;\n      }\n      if(this.userDataService.token) uri += '&token='+ this.userDataService.token;\n      this.http.get<any>(uri).subscribe(data => {\n        if(data.error) reject(data);\n        resolve(data);        \n      }, reject);\n    });\n  }\n\n  /**\n   * POST\n   * @param endpoint \n   * @param params \n   * @param body \n   */\n  POST(\n    endpoint: string = null,\n    params: any = {},\n    body: any = {}\n  ): Promise<any> {\n    return new Promise((resolve, reject) => {\n      if(!this.CONFIG.backend) {\n        console.error('[Error][Sheetbase] No backend for this project!');\n        reject(null);\n      }\n\n      // build uri\n      let uri: string = 'https://script.google.com/macros/s/'+ this.CONFIG.backend +'/exec';\n      if(endpoint) uri += '?e='+ endpoint;\n      if(!endpoint && Object.keys(params||{}).length > 0) uri += '?';\n      for(let key in (params||{})) {\n        uri += '&'+ key +'='+ params[key];\n      }\n      if(!endpoint && Object.keys(params||{}).length > 0) uri = uri.replace('?&', '?');\n\n      // get data\n      body = Object.assign({}, body, {\n        apiKey: this.CONFIG.apiKey\n      });\n      if(this.userDataService.token) body.token = this.userDataService.token;\n      this.http.post<any>(uri, JSON.stringify(body), {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      }).subscribe(data => {\n        if(data.error) reject(data);\n        resolve(data);\n      }, reject);\n    });\n  }\n\n\n}\n"]}