{"version":3,"file":"file.service.js","sourceRoot":"","sources":["../../../src/services/file.service.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AACnD,OAAO,EAAE,UAAU,EAAE,MAAM,MAAM,CAAC;AAElC,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;;IAYzC,qBACU,MAAc,EAEd,UAAsB;QAFtB,WAAM,GAAN,MAAM,CAAQ;QAEd,eAAU,GAAV,UAAU,CAAY;KAE/B;IAED,yBAAG,GAAH,UAAI,MAAc;QAChB,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,OAAO,EAAE;YAClC,EAAE,EAAE,MAAM;SACX,CAAC,CAAC;KACJ;IAGD,mDAAmD;;IACnD,4BAAM;;IAAN,UAAO,OAAiB,EAAE,YAA2B;QAArD,iBAcC;QAdyB,6BAAA,EAAA,mBAA2B;QACnD,OAAO,IAAI,UAAU,CAAC,UAAA,QAAQ;YAC5B,IAAI,IAAI,GAAQ;gBACd,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,KAAI,CAAC,eAAe,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;oBACxD,IAAI,EAAE,OAAO,CAAC,IAAI;iBACnB,CAAC;aACH,CAAA;YACD,IAAG,YAAY;gBAAE,IAAI,CAAC,MAAM,GAAG,YAAY,CAAC;YAC5C,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,EAAE,IAAI,CAAC;iBACtC,IAAI,CAAC,UAAA,QAAQ;gBACZ,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBACxB,QAAQ,CAAC,QAAQ,EAAE,CAAC;aACrB,CAAC,CAAC;SACJ,CAAC,CAAC;KACJ;IAED,0BAAI,GAAJ,UAAK,IAAU;QACb,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YACjC,IAAI,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;YAC9B,MAAM,CAAC,MAAM,GAAG,UAAC,CAAM;gBACrB,OAAO,CAAC;oBACN,IAAI,EAAE,IAAI,CAAC,IAAI;oBACf,IAAI,EAAE,IAAI,CAAC,IAAI;oBACf,QAAQ,EAAE,IAAI,CAAC,IAAI;oBACnB,MAAM,EAAE,CAAC,CAAC,MAAM,CAAC,MAAM;iBACxB,CAAC,CAAC;aACJ,CAAA;YACD,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;SAC5B,CAAC,CAAC;KACJ;IAEO,qCAAe,GAAvB,UAAwB,UAAkB;QACxC,IAAI,aAAa,GAAG,UAAU,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;QACjD,OAAO;YACL,QAAQ,EAAE,aAAa,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;YAC/C,YAAY,EAAE,aAAa,CAAC,CAAC,CAAC;SAC/B,CAAC;KACH;;gBAvDF,UAAU;;;;gBAZU,MAAM;gBAGlB,UAAU;;sBAHnB;;SAaa,WAAW","sourcesContent":["import { Injectable, NgZone } from '@angular/core';\nimport { Observable } from 'rxjs';\n\nimport { ApiService } from './api.service';\n\nexport interface IAppFile {\n  name: string,\n  size: number,\n  mimeType: string,\n  base64: string\n}\n\n@Injectable()\nexport class FileService {\n\n  constructor(\n    private ngZone: NgZone,\n\n    private apiService: ApiService\n  ) {\n  }\n\n  get(fileId: string): Promise<any> {\n    return this.apiService.GET('/file', {\n      id: fileId\n    });\n  }\n\n\n  // TODO: https://xkeshi.github.io/image-compressor/\n  upload(appFile: IAppFile, customFolder: string = null): Observable<any> {\n    return new Observable(observer => {\n      let body: any = {\n        file: Object.assign(this.base64Breakdown(appFile.base64), {\n          name: appFile.name\n        })\n      }\n      if(customFolder) body.folder = customFolder;\n      this.apiService.POST('/file', {}, body)\n      .then(response => {\n        observer.next(response);\n        observer.complete();\n      });\n    });\n  }\n\n  load(file: File): Promise<IAppFile> {\n    return new Promise((resolve, reject) => {\n      let reader = new FileReader();\n      reader.onload = (e: any) => {\n        resolve({\n          name: file.name,\n          size: file.size,\n          mimeType: file.type,\n          base64: e.target.result\n        });\n      }\n      reader.readAsDataURL(file);\n    });\n  }\n\n  private base64Breakdown(base64Data: string) {\n    var breakdownData = base64Data.split(';base64,');\n    return {\n      mimeType: breakdownData[0].replace('data:', ''),\n      base64String: breakdownData[1]\n    };\n  }\n\n\n\n}\n"]}